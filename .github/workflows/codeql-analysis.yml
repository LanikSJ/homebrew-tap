name: "CodeQL Analysis"

on:
  push:
    branches:
      - main
    paths:
      - "**.rb"
      - "**.sh"
      - ".github/workflows/codeql-analysis.yml"
  pull_request:
    branches:
      - main
    paths:
      - "**.rb"
      - "**.sh"
      - ".github/workflows/codeql-analysis.yml"
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
 analyze:
   name: Analyze
   runs-on: ubuntu-latest
   permissions:
     actions: read
     contents: read
     security-events: write

   steps:
   - name: Checkout Repository
     uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

   - name: Cache CodeQL Databases
     id: cache-codeql
     uses: actions/cache@9255dc7a253b0ccc959486e2bca901246202afeb # v5.0.1
     with:
       path: ~/codeql-runner/codeql/databases
       key: codeql-${{ runner.os }}-ruby-${{ hashFiles('**/*.rb') }}
       restore-keys: |
         codeql-${{ runner.os }}-ruby-

   - name: Initialize CodeQL
     uses: github/codeql-action/init@cf1bb45a277cb3c205638b2cd5c984db1c46a412 # v4.31.7
     with:
       languages: ruby
       # config-file: ./.github/codeql/codeql-config.yml

   - name: Perform CodeQL Analysis
     uses: github/codeql-action/analyze@cf1bb45a277cb3c205638b2cd5c984db1c46a412 # v4.31.7
