name: "CodeQL Analysis"

on:
  push:
    branches:
      - main
    paths:
      - "**.rb"
      - "**.sh"
      - ".github/workflows/codeql-analysis.yml"
  pull_request:
    branches:
      - main
    paths:
      - "**.rb"
      - "**.sh"
      - ".github/workflows/codeql-analysis.yml"
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
 analyze:
   name: Analyze
   runs-on: ubuntu-latest
   permissions:
     actions: read
     contents: read
     security-events: write

   steps:
   - name: Checkout Repository
     uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

   - name: Cache CodeQL Databases
     id: cache-codeql
     uses: actions/cache@8b402f58fbc84540c8b491a91e594a4576fec3d7 # v5.0.2
     with:
       path: ~/codeql-runner/codeql/databases
       key: codeql-${{ runner.os }}-ruby-${{ hashFiles('**/*.rb') }}
       restore-keys: |
         codeql-${{ runner.os }}-ruby-

   - name: Initialize CodeQL
     uses: github/codeql-action/init@cdefb33c0f6224e58673d9004f47f7cb3e328b89 # v4.31.10
     with:
       languages: ruby
       # config-file: ./.github/codeql/codeql-config.yml

   - name: Perform CodeQL Analysis
     uses: github/codeql-action/analyze@cdefb33c0f6224e58673d9004f47f7cb3e328b89 # v4.31.10
