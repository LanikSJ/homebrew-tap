name: "CodeQL Analysis"

on:
  push:
    branches:
      - main
    paths:
      - "**.rb"
      - "**.sh"
      - ".github/workflows/codeql-analysis.yml"
  pull_request:
    branches:
      - main
    paths:
      - "**.rb"
      - "**.sh"
      - ".github/workflows/codeql-analysis.yml"
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
 analyze:
   name: Analyze
   runs-on: ubuntu-latest
   permissions:
     actions: read
     contents: read
     security-events: write

   steps:
   - name: Checkout Repository
     uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

   - name: Cache CodeQL Databases
     id: cache-codeql
     uses: actions/cache@0057852bfaa89a56745cba8c7296529d2fc39830 # v4.3.0
     with:
       path: ~/codeql-runner/codeql/databases
       key: codeql-${{ runner.os }}-ruby-${{ hashFiles('**/*.rb') }}
       restore-keys: |
         codeql-${{ runner.os }}-ruby-

   - name: Initialize CodeQL
     uses: github/codeql-action/init@1b168cd39490f61582a9beae412bb7057a6b2c4e # v4.31.8
     with:
       languages: ruby
       # config-file: ./.github/codeql/codeql-config.yml

   - name: Perform CodeQL Analysis
     uses: github/codeql-action/analyze@1b168cd39490f61582a9beae412bb7057a6b2c4e # v4.31.8
